<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>校园二手交易平台管理系统</title>
    <!--    <link rel="stylesheet" th:href="@{css/allUser.css}">-->
    <link rel="stylesheet" href="../css/Commodity.css">
    <!--    <script th:src="@{js/allUser.js}"></script>-->
</head>
<body>
<div class="nav-box">
    <h2>校园二手交易平台管理系统</h2>
    <ul>
        <li><img src="../image/用户.png" alt=""><a href="allUser.html">用户信息管理</a></li>
        <li><img src="../image/用户.png" alt=""><a href="Commodity.html">商品信息管理</a></li>
        <li><img src="../image/用户.png" alt=""><a href="order_manage.html">订单信息管理</a></li>
        <li><img src="../image/用户.png" alt=""><a href="manager_login.html">切换管理员</a></li>
        <li><img src="../image/退出系统ico.png" alt=""><a href="123.html">退出系统</a></li>
    </ul>
</div>
<div class="container-box">
    <div class="super_box">
        <span>管理员:</span>
        <span th:text="${session.loginUser}"></span>
        <span>></span>
        <span>邮箱:</span>
        <span th:text="${session.email}"></span>
        <span>手机号码:</span>
        <span th:text="${session.tel}"></span>
    </div>
    <!--    <div class="reminder-box"><h3>&nbsp;&nbsp;操作面板&nbsp;&nbsp;</h3></div>-->
    <div class="title-box"><h1>商品信息管理界面</h1></div>
    <div class="funtions-box">
        <input type="text" placeholder="请输入需要查找的商品编号" >
        <button>搜索</button>
        <button>-</button>
        <button>修改</button>
        <button type="button" onclick="addValue()">+</button>
        <button><a th:href="adminAndUser">查看全部商品</a></button>
        <span th:text="${msg}"></span>
    </div>
    <table class="table-th" id="Commodity" data-name="Commodity">
        <tr>
            <th>商品ID</th>
            <th>发布者ID</th>
            <th>名称</th>
            <th>定价</th>
            <th>库存量</th>
            <th>类型</th>
<!--            <th>电话</th>-->
        </tr>
    </table>
    <table class="table" id="tableTh">
<!--        <tr th:each="alluser:${alluser}">-->
<!--            <td >123</td>-->
<!--            <td >123</td>-->
<!--            <td >123</td>-->
<!--            <td >123</td>-->
<!--            <td >123</td>-->
<!--            <td >123</td>-->
<!--&lt;!&ndash;            <td th:text="${alluser.tel}"></td>&ndash;&gt;-->
<!--        </tr>-->
    </table>
    <form class="delect_form"  method="post" th:action="@{/delectUser}">
        <input type="text" name="username">
    </form>
    <form class="add_form" method="post" th:action="@{/register}">
        <h1>注册账号</h1>
        <input type="text" placeholder="用户名" name="username" required>
        <input type="password" placeholder="密码" name="password" required>
        <input type="password" placeholder="确认密码" name="repassword" required>
        <input type="email" placeholder="邮箱" name="email"   required>
        <input type="text" placeholder="手机号码" name="tel"  pattern="\d{11}" required>
        <button type="submit">添加商品</button>
        <button type="button">取消</button>
    </form>
    <form method="post" th:action="@{/updateUser}" class="add_form alter_form" >
        <h1>修改账号</h1>
        <input type="text" name="username" readonly >
        <input type="text" placeholder="是否设置管理员?1是0否" name="status" th:value="0" pattern="[0-1]" required  >
        <input type="password" placeholder="密码" name="password"  required>
        <input type="repassword" placeholder="确认密码" name="repassword" required>
        <input type="email" placeholder="邮箱" name="email" required >
        <input type="text" placeholder="手机号码" name="tel" required  pattern="\d{11}">
        <button type="submit">修改</button>
        <button>取消</button>
    </form>
</div>
</body>

<script>
    const table = document.getElementsByClassName("table")[0];
    const funtionsInput = document.querySelectorAll(".funtions-box input")[0];
    const funtionsButtonSearch = document.querySelectorAll(".funtions-box button")[0];
    const funtionsButtonDelect = document.querySelectorAll(".funtions-box button")[1];
    const funtionsButtonUpdata = document.querySelectorAll(".funtions-box button")[2];
    const funtionsButtonAdd = document.querySelectorAll(".funtions-box button")[3];

    const formDelect = document.getElementsByClassName("delect_form")[0];
    const formAdd = document.getElementsByClassName("add_form")[0];
    const formAlter = document.getElementsByClassName("alter_form")[0];

    const formAddAllButton = document.querySelectorAll(".add_form button");
    const formAlterAllButton = document.querySelectorAll(".alter_form button");
    const nameTd = [];

    addButtonSearch()

    //addValue()
    delectUser()




    //var resultCollection = myObj.data;
    // for(var i = 0; i < resultCollection; i++) {
    //     console.log(resultCollection[i].id);
    // }


    function addButtonSearch()//点击查找按钮时
    {
        funtionsButtonSearch.addEventListener('click',()=>{
            if(funtionsInput.value!=='')
            {
                getNameAllTd()
                let i;
                for(i = 0; i<nameTd.length; i++)
                {
                    if(funtionsInput.value===nameTd[i].innerText){
                        table.innerHTML='';
                        table.appendChild(nameTd[i].parentNode);
                        document.querySelector(".funtions-box span").innerText="查找成功!再次查找请先显示所有用户"
                        break
                    }
                }
                if(i===nameTd.length)
                {
                    alert("没有找到该用户")
                }
            }
            else
            {
                alert("用户名为空!")
            }

        })
    }

    function getNameAllTd()//获取表格每一行的名字
    {
        for(let i=0;i<table.rows.length;i++)
        {
            nameTd[i]=table.rows[i].cells[0]
            //alert(nameTd[i].toString());
        }
    }

    function addValue()
    {
        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "../user/login", true);
        xhttp.setRequestHeader('Content-Type', 'application/json');
        xhttp.send();

        xhttp.onreadystatechange = function()
        {

            if (this.readyState == 4 && this.status == 200)
            {
                var myObj = JSON.parse(this.responseText);
                var data = myObj.data;
                var tbody = document.getElementById('tableTh');
                tbody.className="table";

                alert("45456");
                //for(var i = 0;i < data.length; i++){ //遍历一下json数据
                    var trow = addValue1(myObj); //定义一个方法,返回tr数据
                    tbody.appendChild(trow);
                    // var Id=per[i].id;
                    // tbody.innerHTML += "<tr>   <td>"+Id+"</td>  <td>1</td>   <td>1</td>    <td>1</td>    <td>1</td>     <td>1</td> </tr>";
                //}
            }
        }

        // var tbody = document.getElementById('tableTh');
        // tbody.className="table";
        // var data= [
        //     {id:001,name:'张珊',job:'学生'},
        //     {id:002,name:'李斯',job:'教师'},
        //     {id:003,name:'王武',job:'经理'}]
        // for(var i = 0;i < data.length; i++){ //遍历一下json数据
        //     var trow = addValue1(data[i]); //定义一个方法,返回tr数据
        //     tbody.appendChild(trow);
        //     // var Id=per[i].id;
        //     // tbody.innerHTML += "<tr>   <td>"+Id+"</td>  <td>1</td>   <td>1</td>    <td>1</td>    <td>1</td>     <td>1</td> </tr>";
        // }

    }


    function addValue1(h)
    {
        var row = document.createElement('tr'); //创建行

        var idCell = document.createElement('td'); //创建第一列id
        //idCell.className="add-form";
        idCell.innerHTML = h.code; //填充数据
        row.appendChild(idCell); //加入行  ，下面类似

        var nameCell = document.createElement('td');//创建第二列name
        //nameCell.className="table-th";
        nameCell.innerHTML = h.code;
        row.appendChild(nameCell);

        var jobCell = document.createElement('td');//创建第三列job
        //jobCell.className="table-th";
        jobCell.innerHTML = h.code;
        row.appendChild(jobCell);

        // var emailCell = document.createElement('td');//创建第三列job
        // //emailCell.className="table-th";
        // emailCell.innerHTML = h.publisher;
        // row.appendChild(emailCell);
        //
        // var telCell = document.createElement('td');//创建第三列job
        // //telCell.className="table-th";
        // telCell.innerHTML = h.type;
        // row.appendChild(telCell);
        //
        // var numCell = document.createElement('td');//创建第三列job
        // //telCell.className="table-th";
        // numCell.innerHTML = h.price;
        // row.appendChild(numCell);

        // var delCell = document.createElement('td');//创建第四列，操作列
        // row.appendChild(delCell);
        // var btnDel = document.createElement('input'); //创建一个input控件
        // btnDel.setAttribute('type','button'); //type="button"
        // btnDel.setAttribute('value','删除');
        //
        // //删除操作
        // btnDel.οnclick=function(){
        //     if(confirm("确定删除这一行嘛？")){
        //         //找到按钮所在行的节点，然后删掉这一行
        //         this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
        //         //btnDel - td - tr - tbody - 删除(tr)
        //         //刷新网页还原。实际操作中，还要删除数据库中数据，实现真正删除
        //     }
        // }
        // delCell.appendChild(btnDel);  //把删除按钮加入td，别忘了

        return row; //返回tr数据

    }


    function delectUser()//点击删除按钮
    {
        funtionsButtonDelect.addEventListener('click',()=>{
            //输入框不为空继续
            //不为空后如果找到输入框与表格一致的姓名则可删除用户
            var tbody = document.getElementById('tableTh');
            if(funtionsInput.value!=='') {
                getNameAllTd()
                for(let i=0;i<nameTd.length;i++){
                    if(funtionsInput.value===nameTd[i].innerText){
                        let remiderDelect=window.confirm("你确定要删除"+funtionsInput.value+"用户吗?")
                        if(remiderDelect===true)
                        {

                            //formDelect.firstElementChild.value=funtionsInput.value
                            //formDelect.submit()//表单提交至后端，用后端处理删除用户

                        }
                        break;
                    }
                }
                if(i===nameTd.length){ //如果i==所有名字的长度，证明没有找到用户
                    alert("没有找到该用户")
                }
            }
            else{
                alert("用户名为空!")
            }
        })
    }


    // window.onload=function (){
    //     const table = document.getElementsByClassName("table")[0];
    //     const funtionsInput = document.querySelectorAll(".funtions-box input")[0];
    //     const funtionsButtonSearch = document.querySelectorAll(".funtions-box button")[0];
    //     const funtionsButtonDelect = document.querySelectorAll(".funtions-box button")[1];
    //     const funtionsButtonUpdata = document.querySelectorAll(".funtions-box button")[2];
    //     const funtionsButtonAdd = document.querySelectorAll(".funtions-box button")[3];
    //
    //     const formDelect = document.getElementsByClassName("delect_form")[0];
    //     const formAdd = document.getElementsByClassName("add_form")[0];
    //     const formAlter = document.getElementsByClassName("alter_form")[0];
    //
    //     const formAddAllButton = document.querySelectorAll(".add_form button");
    //     const formAlterAllButton = document.querySelectorAll(".alter_form button");
    //     const nameTd = [];
    //
    //     addButtonSearch()
    //     delectUser()
    //     addUser()
    //     alterUser()
    //
    //     function addButtonSearch()//点击查找按钮时
    //     {
    //         funtionsButtonSearch.addEventListener('click',()=>{
    //             if(funtionsInput.value!=='')
    //             {
    //                 getNameAllTd()
    //                 let i;
    //                 for(i = 0; i<nameTd.length; i++)
    //                 {
    //                     if(funtionsInput.value===nameTd[i].innerText){
    //                         table.innerHTML='';
    //                         table.appendChild(nameTd[i].parentNode);
    //                         document.querySelector(".funtions-box span").innerText="查找成功!再次查找请先显示所有用户"
    //                         break
    //                     }
    //                 }
    //                 if(i===nameTd.length)
    //                 {
    //                     alert("没有找到该用户")
    //                 }
    //             }
    //             else
    //             {
    //                 alert("用户名为空!")
    //             }
    //
    //         })
    //     }
    //
    //     function getNameAllTd()//获取表格每一行的名字
    //     {
    //         for(let i=0;i<table.rows.length;i++)
    //         {
    //             nameTd[i]=table.rows[i].cells[1]
    //         }
    //     }
    //
    //     function delectUser()//点击删除按钮
    //     {
    //         funtionsButtonDelect.addEventListener('click',()=>{
    //             //输入框不为空继续
    //             //不为空后如果找到输入框与表格一致的姓名则可删除用户
    //             if(funtionsInput.value!=='') {
    //                 getNameAllTd()
    //                 for(let i=0;i<nameTd.length;i++){
    //                     if(funtionsInput.value===nameTd[i].innerText){
    //                         let remiderDelect=window.confirm("你确定要删除"+funtionsInput.value+"用户吗?")
    //                         if(remiderDelect===true)
    //                         {
    //                             formDelect.firstElementChild.value=funtionsInput.value
    //                             formDelect.submit()//表单提交至后端，用后端处理删除用户
    //                         }
    //                         break;
    //                     }
    //                 }
    //                 if(i===nameTd.length){ //如果i==所有名字的长度，证明没有找到用户
    //                     alert("没有找到该用户")
    //                 }
    //             }
    //             else{
    //                 alert("用户名为空!")
    //             }
    //         })
    //     }
    //
    //     function addUser(){ //点击+按钮
    //         funtionsButtonAdd.addEventListener('click',()=>{
    //             formAdd.style.visibility="visible" //添加用户表单显示
    //         })
    //         formAddAllButton[1].addEventListener('click',()=>{
    //             formAdd.style.visibility="hidden" //添加用户表单点击取消隐藏表单
    //         })
    //     }
    //
    //     function alterUser(){
    //         funtionsButtonUpdata.addEventListener('click',()=>{
    //             if(funtionsInput.value!=='') {
    //                 let i;
    //                 getNameAllTd()
    //                 for(i = 0; i<nameTd.length; i++){
    //                     if(funtionsInput.value===nameTd[i].innerText){
    //                         document.querySelectorAll(".alter_form input")[0].value=funtionsInput.value
    //                         formAlter.style.visibility="visible"
    //                         break;
    //                     }
    //                 }
    //                 if(i===nameTd.length){
    //                     alert("没有找到该用户")
    //                 }
    //             }
    //             else{
    //                 alert("用户名为空!")
    //             }
    //         })
    //         formAlterAllButton[1].addEventListener('click',()=>{
    //             formAlter.style.visibility="hidden"
    //         })
    //     }
    // }
</script>

</html>
